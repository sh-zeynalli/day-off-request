<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Requests</title>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
          integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-timepicker/0.5.2/css/bootstrap-timepicker.min.css">

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.5/css/bootstrap-select.min.css">

    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap-theme.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-timepicker/0.5.2/css/bootstrap-timepicker.css">

    <!-- DataTables JS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ"
            crossorigin="anonymous">
    </script>

    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-timepicker/0.5.2/js/bootstrap-timepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-timepicker/0.5.2/js/bootstrap-timepicker.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.5/js/bootstrap-select.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>

</head>
<body>

<button id="mainPageBtn" style="margin-left:30px; margin-top: 30px" type="button" class="btn btn btn-primary">Əsas
    səhifə
</button>

<a type="button" class="btn btn btn-primary" id="transferBtn" style="
 margin-top: 30px" >Səlahiyyətləri ötürmək</a>

<div class="container" style="margin-top: 30px">
    <table class="table" id="requests" cellpadding="0" align="center" width="80%">
        <thead>
        <tr>
            <th scope="col" class="text-center">#</th>
            <th scope="col" class="text-center">İcazəni alan şəxs</th>
            <th scope="col" class="text-center">İcazə alınan tarix</th>
            <th scope="col" class="text-center">İcazənin növü</th>
            <th scope="col" class="text-center">Gediş vaxtı</th>
            <th scope="col" class="text-center">Dönüş vaxtı</th>
            <th scope="col" class="text-center">Səbəb</th>

        </tr>
        </thead>
        <tbody>
        <tr th:each="p, id: ${permissionList}" align="center" th:object="${permission}">

            <td th:if="${ p.status}==0" th:text="${id.count}"></td>
            <td th:if="${ p.status}==0" th:text="${p.employees.fullname}"></td>
            <td th:if="${ p.status}==0" th:text="${p.date}"></td>
            <td th:if="${ p.status}==0" th:text="${p.type.name}"></td>
            <td th:if="${ p.status}==0" th:text="${p.startDate}"></td>
            <td th:if="${ p.status}==0" th:text="${p.endDate}"></td>
            <td th:if="${ p.status}==0" th:text="${p.reason}"></td>
            <td th:if="${ p.status}==0">
                <a type="button" class="btn btn btn-primary rejectBtn"
                   style="background: #ac2925; border-color: inherit"
                   id="rejectBtn" data-th-id="${p.id}"><i class="fas fa-times-circle"></i></a>
                <a type="button" class="btn btn btn-primary"
                   style="background: forestgreen; border-color: inherit"
                   id="acceptBtn" th:href="@{/requests/accept/{id}(id=${p.id})}"><i class="fas fa-vote-yea"></i></a>
            </td>
        </tr>
        </tbody>

    </table>

</div>
<div style="text-align: center;">
            <span th:text="${emptyPermissionList}" style="
            font-size: x-large;
            color: hotpink;
            font-family: Segoe UI Light;">
            </span>
</div>

<div class="modal fade" id="rejectModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <input type="hidden" name="">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">

                <input type="hidden" id="reject_id" value="">

                <!--<label for="personId">ID</label><input th:value="*{id}" id="personId" name="id" type="number" class="form-control">-->
                <label>İcazəni qəbul etməməyinizin səbəbini yazın</label><br>

                <textarea class="form-control" id="rejectReason"></textarea><br>
            </div>
            <div class="modal-footer">
                <a type="button" class="btn btn-danger" data-dismiss="modal"
                   id="rejectSelectedId">OK</a>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>

            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="transferModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <label>Səlahiyyətlərinizi ötürdüyünüz şəxs sizin yerinizə icazə sorğularına baxa və qərar verə bilər!</label><br>

                <div class="container">
                    <select class="selectpicker" th:field="*{employeesTransfer}" data-style="btn-primary" multiple
                            id="employeesTransfer" data-max-options="1" th:value="*{employeesTransfer}">
                        <option
                                th:each="employeesTransfer: ${employeesTransfer}" th:text="${employeesTransfer.fullname}"
                                th:value="${employeesTransfer.id}"></option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <a type="button" class="btn btn-danger" data-dismiss="modal"
                   id="trOkBtn">OK</a>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>

            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {

        $("#transferBtn").click(function () {
            $("#transferModal").modal('show');
        })
        $("#trOkBtn").click(function () {
            console.log("tr id:"+$("#employeesTransfer").val());
            $.ajax({
                method: 'get',
                url: '/home/requests/transfer/',
                data: "trId=" + $("#employeesTransfer").val(),
                success: function (data) {
                    console.log("transfer success");
                    location.reload();

                },
                error: function () {
                    console.log("error transfer");
                }
            })
        })
        $(function () {
            $('[data-toggle="popover"]').popover()
        })
        $(document).on("click", ".rejectBtn", function () {
            var id = $(this).attr('id');

            $(".modal-body #reject_id").val(id);
            $("#rejectModal").modal('show');
        });
        $("#rejectSelectedId").click(function () {
            var id = $('#reject_id').val();
            var reason = $('#rejectReason').val();
//            var e = $(this).attr('employees');
            console.log(id + "  " + reason);
            $.ajax({
                method: 'get',
                url: '/home/requests/reject/' + id,
                data: "reason=" + reason,
                success: function () {
                    console.log("request was rejected");
                    alert("Cavabınız göndərildi");
                    location.reload();

                },
                error: function () {
                    console.log("error");
                }
            })

//            $.get("/home/requests/reject/" + id, function (data)
//            {
//
//            })
        });

    })
</script>

<script>
    $(document).ready(function () {
        $("#mainPageBtn").click(function () {
            $.ajax({
                url: '/',
                method: 'get'
            })
            window.location.replace("http://localhost:8083/home");
        })
    })
</script>

</body>
</html>